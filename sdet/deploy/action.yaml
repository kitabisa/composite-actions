name: "sdet deploy"
description: "sdet composite deploy reports"

inputs:
  profile:
    required: false
    description: "profile"
    default: ""
    type: string

  custom_command_report_folder:
    required: false
    description: "custom command report folder"
    default: ""
    type: string

  app_id:
    required: false
    description: "GitHub App ID for generating token to create verified commits"
    default: ""
    type: string

  app_private_key:
    required: false
    description: "GitHub App private key for generating token to create verified commits"
    default: ""
    type: string

runs:
  using: "composite"
  steps:
    - name: generate github app token
      if: ${{ inputs.app_id != '' }}
      uses: actions/create-github-app-token@v1
      id: app-token
      with:
        app-id: ${{ inputs.app_id }}
        private-key: ${{ inputs.app_private_key }}

    - name: report history action
      uses: kitabisa/report-history-action@master
      with:
        subfolder: ${{ inputs.profile }}
        keep_reports: 3
        report_folder: ${{ inputs.custom_command_report_folder }}
        gh_pages: gh-pages
        report_history: report-history

    - name: deploy reports to github pages (verified)
      if: ${{ inputs.app_id != '' }}
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: report-history
        clean: true
        single-commit: true
        token: ${{ steps.app-token.outputs.token }}

    - name: deploy reports to github pages
      if: ${{ inputs.app_id == '' }}
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: report-history
        clean: true
        single-commit: true
